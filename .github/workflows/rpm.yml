name: rpm-builder

on: [pull_request]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v2
    - name: Create copr credential file
      run: 	rpm/copr-cred.sh
      env:
        COPR_LOGIN: ${{ secrets.COPR_LOGIN }}
        COPR_USERNAME: ${{ secrets.COPR_USERNAME }}
        COPR_TOKEN: ${{ secrets.COPR_TOKEN }}
    - name: Start rpm-builder container
      run: 	docker run -it -d --name rpm-build -v /home/runner/work/gcloud-knife:/project --cap-add=SYS_ADMIN --security-opt apparmor:unconfined spideyz0r/mockzor
    - name: Build package
      run: 	docker exec rpm-build /project/gcloud-knife/rpm/build.sh

